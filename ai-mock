import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class ChatService {
  
  private responses: { [key: string]: string } = {
    'hello': 'Hi there! How can I help you today? I\'m here to answer your questions and assist you with anything you need.',
    'how are you': 'I\'m doing great, thank you for asking! I\'m an AI assistant, so I don\'t have feelings, but I\'m functioning perfectly and ready to help you.',
    'what is angular': 'Angular is a powerful web application framework developed by Google. It uses TypeScript and follows a component-based architecture. Angular provides tools for routing, forms, HTTP client, and much more to build scalable single-page applications.'
  };

  sendMessage(message: string): Observable<string> {
    return new Observable(observer => {
      const lowerMessage = message.toLowerCase().trim();
      
      // Find matching response
      let response = 'I\'m not sure how to respond to that. Try asking "hello", "how are you", or "what is angular".';
      
      for (const key in this.responses) {
        if (lowerMessage.includes(key)) {
          response = this.responses[key];
          break;
        }
      }
      
      // Simulate streaming by emitting character by character
      let index = 0;
      const interval = setInterval(() => {
        if (index < response.length) {
          observer.next(response[index]);
          index++;
        } else {
          clearInterval(interval);
          observer.complete();
        }
      }, 30); // Emit every 30ms for streaming effect
      
      // Cleanup
      return () => clearInterval(interval);
    });
  }
}
